{% extends "base.html" %}
{% block title %}Results{% endblock %}
{% block content %}

<div id="results-info" class="navbar navbar-default navbar-fixed-top navbar-results">
    <div class="container" style="max-width: 960px;">
        <div id="head" class="navbar-header">
            <button type="button" class="navbar-toggle" style="width: 44px;" data-toggle="offcanvas">
                <span class="glyphicon glyphicon-search"></span>
            </button>
            <button type="button" class="btn btn-default navbar-btn navbar-right hidden-xs" data-toggle="offcanvas">
                <span class="glyphicon glyphicon-search"></span> Options
            </button>
            <h4 class="nav-text">
            {% if search %}
                {% if length == 1 %}
                    Found {{ length }} result for "{{ search }}" in {{ time }} seconds
                {% elif length > 1 %}
                    Found {{ length }} results for "{{ search }}" in {{ time }} seconds
                {% else %}
                    Found {{ length }} results for "{{ search }}"
                {% endif %}
            {% else %}
                {% if length == 1 %}
                    Found {{ length }} result for selected filters in {{ time }} seconds
                {% elif length > 1 %}
                    Found {{ length }} results for selected filters in {{ time }} seconds
                {% else %}
                    Found {{ length }} results for selected filters
                {% endif %}
            {% endif %}
            </h4>
            <h5 class="nav-text">
            {% if length > 0 %}
                Results Displayed: <strong>{{ pag_res.start_index }} - {{ pag_res.end_index }}</strong>
            {% else %}
                No records to display
            {% endif %}
            </h5>

        </div>
    </div>
</div>
<div class="container" style="max-width: 960px; position: relative;">
        <div class="sidebar">
            <div class="options">
                <form id="result-form" class="form-search" role="form" method="get" action = '/results/'>{% csrf_token %}
                    <div class="input-group" style="width: 260px;">
                        <input type="text" id="input_text" class="form-control" name="user_input" placeholder="Enter Search">
                        <span class="input-group-btn">
                            <button type="submit" class="btn btn-nyc" id="btn" name="btn" value="Refine / Search" onclick="$.jStorage.set('scrollPosition', 0);">Search</button>
                        </span>
                    </div>
			<!--
                    <br>
                    <input type="checkbox" class="popover-hover-right" name="fulltext" data-toggle="popover" data-content="Checking this option will enable searching within entire document texts."> Enable Full-Text Searching
                    <br> --> <br>
                    <div id="selects">
                        <select name="agency[]" id="agencies" class="selectpicker input-medium" multiple data-live-search="true" style="display: none;">
                        {% for agency in agencies %}
                            <option value="{{ agency }}">{% if agency == 'Metropolitan Transportation Authority' %}MTA {% else %}{{ agency }} {% endif %}</option>
                        {% endfor %}
                        </select>
                        <br><br>
                        <select name="category[]" id="categories" class="selectpicker" multiple data-live-search="true" style="display: none;">
                        {% for category in categories %}
                            <option value="{{ category }}">{{ category }}</option>
                        {% endfor %}
                        </select>
                        <br><br>
                        <select name="type[]" id="types" onfocus="skipcycle=true" onblur="skipcycle=false" class="selectpicker" multiple data-live-search="true" style="display: none;">
                        {% for type in types %}
                            <option value="{{ type }}">{% if type == 'Bond Offering - Official Statements' %}Bond Offering {% else %}{{ type }} {% endif %}</option>
                        {% endfor %}
                        </select>
                    </div>
                    <br>
                    <div class="btn-group btn-group-justified" style="width: 260px;">
                        <div class="btn-group">
                            <button type="submit" class="btn btn-nyc" id="btn" name="btn" value="Refine / Search" onclick="$.jStorage.set('scrollPosition', 0);">Filter</button>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn btn-coral" id="btn" value="Remove All">Remove Filters</button>
                        </div>
                    </div>
                </form>
                <br>
                <div class="btn-group btn-group-justified" style="width: 260px;">
                    <div class="btn-group">
                        <button type="button" class="btn btn-default disabled">Results Per Page</button>
                    </div>
                    <div class="btn-group dropup">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                        	{{ num_results }} <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu" onclick="$.jStorage.set('scrollPosition', 0);">
                            <li><a href="/results/?num_results=10">10</a></li>
                            <li><a href="/results/?num_results=20">20</a></li>
                            <li><a href="/results/?num_results=50">50</a></li>
                            <li><a href="/results/?num_results=100">100</a></li>
                        </ul>
                    </div>
                </div>
{#                <br>#}
                <div class="btn-group btn-group-justified" style="width: 260px;">
                    <div class="btn-group">
                        <button type="button" class="btn btn-default disabled">Sort By </button>
                    </div>
                    <div class="btn-group dropup">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                            {{ sort_method }} <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu" onclick="$.jStorage.set('scrollPosition', 0);">
                            <li><a href="/results/?sort=Relevance" >Relevance</a></li>
                            <li class="divider"></li>
                            <p style="padding-left: 10px; font-weight: bold;">Date</p>
                            <li><a href="/results/?sort=Date: Newest">Newest</a></li>
                            <li><a href="/results/?sort=Date: Oldest">Oldest</a></li>
                            <li class="divider"></li>
                            <p style="padding-left: 10px; font-weight: bold;">Title</p>
                            <li><a href="/results/?sort=Title: A - Z">A - Z</a></li>
                            <li><a href="/results/?sort=Title: Z - A">Z - A</a></li>
                            <li class="divider"></li>
                            <p style="padding-left: 10px; font-weight: bold;">Agency</p>
                            <li><a href="/results/?sort=Agency: A - Z">A - Z</a></li>
                            <li><a href="/results/?sort=Agency: Z - A">Z - A</a></li>
                        </ul>
                    </div>
                </div>
                <br>
                <div class="btn-group btn-group-justified" style="width: 260px;">
        			<a type="button" {% if list_view %} class="btn btn-default navbar-btn" {% else %} class="btn btn-default navbar-btn disabled" {% endif %} href="/results/?list_view=0">
        				<span class="glyphicon glyphicon-th-list"></span>
        			</a>
        			<a type="button" {% if not list_view %} class="btn btn-default navbar-btn" {% else %} class="btn btn-default navbar-btn disabled" {% endif %} href="/results/?list_view=1">
        				<span class="glyphicon glyphicon-list"></span>
        			</a>
        		</div>
                <br>
                <div style="width: 260px;">
                    <button id="2top" style="display: none;" onclick="$('body').animate({ scrollTop: 0 }, 'slow');" type="button" class="btn btn-default">
                        <span class="glyphicon glyphicon-arrow-up"></span> Return To Top
                    </button>
                </div>

            </div>
        </div>
        <div class="row" id="results">
            {% if results %}
                {% for result in results %}

                <div class="panel panel-result">
                    {% if not list_view %}
                    <div class="panel-heading">
                        <h3 class="panel-title"><b>{{ result.rank }}. <span style="text-decoration: underline;"> {{ result.title | safe }}</span> </b></h3>
                    </div>
                    <div class="panel-body">
                        <h5><b>{{ result.agency | safe }}</b></h5>
                        <h5>{{ result.category | safe }}</h5>
                        <p>
                            <small>{{ result.date_created }}</small>
                            <small style="padding-left: 2em">{{ result.type|safe }}</small>
                        </p>
                        <p> {{ result.description | safe }} </p>
                        <p>
                            {% if result.url != '' %}
                            <form method="post" action="/publication/" style="display: inline-block;">{% csrf_token %}
                                <button type="submit" class="btn btn-sm btn-nyc" name="view" value="{{ result.id }}"> <!-- we can also use result.url so we do not have elastic-search -->
                                    <span class="glyphicon glyphicon-eye-open"></span> View
                                </button>
                            </form>
                            <a href="http://localhost:5000{{ result.url }}" download="{{ result.filename }}.pdf" class="btn btn-sm btn-nyc">
                                <span class="glyphicon glyphicon-save"></span> Save
                            </a>
                            {% else %}
                            <form method="post" action="/publication_not_found.html" style="display: inline-block;">{% csrf_token %}
                                <button type="submit" class="btn btn-sm btn-nyc" name="view" value="{{ result.id }}">
                                    <span class="glyphicon glyphicon-eye-open"></span> View
                                </button>
                            </form>
                            <form method="post" action="#" style="display: inline-block;">{% csrf_token %}
                                <button type="submit" class="btn btn-sm btn-nyc">
                                    <span class="glyphicon glyphicon-save"></span> Save
                                </button>
                            </form>
                            {% endif %}
                        </p>
                    </div>
                    {% else %}
                    <div class="panel-heading">
                        <h3 class="panel-title">
	                        {% if result.url != '' %} 
	                        	<a href="http://localhost:8000/{{ result.url }}">
		                    {% else %} <a href="#">{% endif %}<b>{{ result.rank }}. <span style="text-decoration: underline;">{{ result.title|safe }}</span></b></a></h3>
                    </div>
                    <div class="panel-body">
                        <p>
                            <b>{{ result.agency|safe }}</b> | <b>{{ result.category|safe }}</b> | <b>{{ result.type|safe }}</b> | <b>{{ result.date_created }}</b>
                        </p>
                    </div>
                    {% endif %}
            </div>
                {% endfor %}
            {% else %}
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Your search did not return any results.</h3>
                </div>
                <div class="panel-body">
                    <p>Suggestions:
                    <ul>
                        <li>Change your filter(s)</li>
                        <li>Remove all filters</li>
                        <li>Start a new search</li>
                        <li>Simplify your search</li>
                        <li>Check your spelling</li>
                    </ul>
                    </p>
                </div>
            </div>
            {% endif %}
            {# include pagination #}
            {% load endless %}
            {% paginate num_results records %}
            {% get_pages %}
            {% if pages.paginated %}
            <ul class = "pagination" style="padding: 0;">
                <li>{{ pages }}</li>
            </ul>
        {% endif %}
        </div>
</div>

{% endblock %}
